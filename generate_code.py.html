<html>
<head>
<link href="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css" rel="stylesheet" type="text/css"/>
<script src="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js" type="text/javascript"></script>
</head>
<body onload="prettyPrint()">
<pre class="prettyprint linenums">
import sys, os

file_to_add = sys.argv[1]
message = sys.argv[2]
assert os.path.exists(file_to_add)

page = '''\
&lt;html&gt;
&lt;head&gt;
&lt;link href=&quot;http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;/&gt;
&lt;script src=&quot;http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body onload=&quot;prettyPrint()&quot;&gt;
&lt;pre class=&quot;prettyprint linenums&quot;&gt;
{}
&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;'''

link_to_page = '&lt;p&gt;{} &lt;a href=&quot;{}&quot;&gt;here&lt;/a&gt;!&lt;/p&gt;\n'.format(message, file_to_add+'.html')
link_to_page += '{1}'

handler_script = open('myhandler.py', 'r+b')
f_in = open(file_to_add)
f_out = open(file_to_add + '.html', 'wb')

old_script = handler_script.read()
new_script = old_script.format('\''+file_to_add+'.html\',\n\t{0}', link_to_page)
handler_script.seek(0)
handler_script.write(new_script)

a = lambda x: x.replace('&lt;', '&lt;').replace('&gt;', '&gt;')
b = lambda x: a(x).replace('\t', '&nbsp;'*4).replace(' '*4, '&nbsp;'*4)
c = lambda x: b(x).replace('&quot;', '&quot;')

f_out.write(page.format(c(f_in.read())))


sys.exit(1)

</pre>
</body>
</html>