<!DOCTYPE html>
<html>
<head>
<link href="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css" rel="stylesheet" type="text/css">
<script src="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js" type="text/javascript"></script>
</head>
<body onload="prettyPrint()">
<pre class="prettyprint linenums">
#!/usr/bin/python
import sys, re

script_name = sys.argv[1]
html_name = re.sub('\.py$', '.html', script_name)

#whitelist the new file
whitelist = open('whitelist', 'r+b')
new_whitelist = whitelist.read().format('&quot;{}&quot;'.format(html_name)+&quot;,{}&quot;)
whitelist.seek(0)
whitelist.write(new_whitelist)

f_in = open(script_name)
f_out = open(html_name, 'w')

html = '''\
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;link href=&quot;http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
&lt;script src=&quot;http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body onload=&quot;prettyPrint()&quot;&gt;
&lt;pre class=&quot;prettyprint linenums&quot;&gt;
{}
&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;
'''

#fix tabs
a = lambda s: s.replace(' '*4, '&nbsp;'*4).replace('\t', '&nbsp;'*4)
#fix &lt; and &gt;
b = lambda s: a(s).replace('&lt;', '&lt;').replace('&gt;', '&gt;')
#fix double quotes
c = lambda s: b(s).replace('&quot;', '&quot;')

f_out.write(html.format(c(f_in.read())))

</pre>
</body>
</html>
